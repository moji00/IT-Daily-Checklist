<?php require 'config.php'; if(!is_logged_in()){ http_response_code(403); echo 'Not logged in'; exit; } $utid = intval($_POST['utid'] ?? 0); $status = $_POST['status'] ?? 'pending'; if(!in_array($status,['pending','in_progress','completed'])) $status='pending'; $stmt = $mysqli->prepare('SELECT user_id FROM user_tasks WHERE id = ?'); $stmt->bind_param('i',$utid); $stmt->execute(); $r = $stmt->get_result()->fetch_assoc(); if(!$r){ http_response_code(404); echo 'Not found'; exit; } if($r['user_id'] != $_SESSION['user_id'] && !is_admin()){ http_response_code(403); echo 'Forbidden'; exit; } $u = $mysqli->prepare('UPDATE user_tasks SET status = ?, updated_at = NOW() WHERE id = ?'); $u->bind_param('si', $status, $utid); $u->execute(); echo 'OK'; ?>